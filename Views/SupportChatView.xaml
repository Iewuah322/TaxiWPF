<Window x:Class="TaxiWPF.Views.SupportChatView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Чат поддержки" Height="600" Width="450"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None" AllowsTransparency="True" Background="Transparent"
        FontFamily="Segoe UI"
        MouseLeftButtonDown="Window_MouseLeftButtonDown">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <Style x:Key="MessageBorderStyle" TargetType="Border">
            <Setter Property="MaxWidth" Value="300"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect ShadowDepth="1" Color="#E0E0E0" Opacity="0.8" BlurRadius="5"/>
                </Setter.Value>
            </Setter>
            <Setter Property="Background" Value="White"/>
            <Setter Property="HorizontalAlignment" Value="Left"/>
            <Setter Property="CornerRadius" Value="15,15,15,0"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsFromCurrentUser}" Value="True">
                    <Setter Property="Background" Value="#FFC107"/>
                    <Setter Property="HorizontalAlignment" Value="Right"/>
                    <Setter Property="CornerRadius" Value="15,15,0,15"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Border Background="#F9F9F9" CornerRadius="10" BorderBrush="#E0CA8A" BorderThickness="1">
        <Border.Effect>
            <DropShadowEffect ShadowDepth="0" Color="Gray" Opacity="0.3" BlurRadius="15"/>
        </Border.Effect>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Border Grid.Row="0" Background="#FDF4CD" Padding="15,12" CornerRadius="10,10,0,0">
                <Grid>
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="{Binding ChatTitle}" FontWeight="Bold" FontSize="14" Foreground="#4F4A45"/>
                        <TextBlock Text="{Binding ChatSubTitle}" Foreground="#A8986B" FontSize="11"/>
                    </StackPanel>
                    <Button Content="✕" Click="CloseButton_Click" Style="{StaticResource CloseButton}" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                </Grid>
            </Border>
            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" x:Name="MessagesScrollViewer" Margin="5">
                <ItemsControl ItemsSource="{Binding Messages}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Style="{StaticResource MessageBorderStyle}">
                                <StackPanel>
                                    <TextBlock Text="{Binding MessageText}" TextWrapping="Wrap"/>
                                    <TextBlock Text="{Binding Timestamp, StringFormat='HH:mm'}" FontSize="10" Foreground="Gray" Margin="0,5,0,-5" HorizontalAlignment="Right"/>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
            <Border Grid.Row="2" Padding="10" Background="White" CornerRadius="0,0,10,10" BorderBrush="#E0CA8A" BorderThickness="0,1,0,0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox Grid.Column="0" Text="{Binding NewMessageText, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource InputField}" Padding="8" BorderThickness="0" AcceptsReturn="True" TextWrapping="Wrap" MaxHeight="80" VerticalScrollBarVisibility="Auto"/>
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Button Command="{Binding SendMessageCommand}" Content="Отправить" Style="{StaticResource AcceptButton}" Margin="10,0,0,0"/>
                        <Button Command="{Binding ResolveTicketCommand}" Content="Вопрос решен" Style="{StaticResource DeclineButton}" Margin="10,0,0,0" Visibility="{Binding IsManager, Converter={StaticResource BoolToVis}}"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>