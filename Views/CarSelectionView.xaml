<Window x:Class="TaxiWPF.Views.CarSelectionView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:TaxiWPF.ViewModels"
        Title="Выбор автомобиля" Height="720" Width="1280"
        WindowStartupLocation="CenterScreen" MinWidth="900" MinHeight="600"
        WindowStyle="None" AllowsTransparency="True" Background="Transparent"
        FontFamily="Segoe UI" MouseLeftButtonDown="Window_MouseLeftButtonDown">

    <Border Background="#F0EEE9" CornerRadius="10" BorderBrush="#8D837C" BorderThickness="1">
        <Grid>
            <!-- Кнопка закрытия -->
            <Button Content="✕" Command="{Binding CancelCommand}" Style="{StaticResource CloseButton}" HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,5,5,0" Panel.ZIndex="100"/>

            <!-- Основной контент -->
            <Grid Margin="60,50,60,50">
                <!-- Центральная панель -->
                <Border Background="#FFFFFF" 
                        Opacity="0.98"
                        CornerRadius="25" 
                        Padding="0"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        BorderBrush="#E0E0E0"
                        BorderThickness="2">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="30" ShadowDepth="8" Opacity="0.25" Color="Black"/>
                    </Border.Effect>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Заголовок -->
                        <Border Grid.Row="0" Background="#F8F8F8" CornerRadius="25,25,0,0" Padding="30,20">
                            <Grid>
                                <StackPanel>
                                    <TextBlock Text="🚗 ВЫБЕРИТЕ АВТОМОБИЛЬ" 
                                               FontSize="24" 
                                               FontWeight="Bold" 
                                               Foreground="#333333"/>
                                    <TextBlock Text="Выберите автомобиль для выхода на линию" 
                                               FontSize="14" 
                                               Foreground="#888888" 
                                               Margin="0,5,0,0"/>
                                </StackPanel>
                                <Button Content="➕ Добавить авто" 
                                        Command="{Binding AddCarCommand}" 
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Center"
                                        Padding="20,12"
                                        FontSize="14"
                                        Background="#E8F5E9"
                                        Foreground="#28A745"
                                        BorderThickness="0"
                                        Cursor="Hand">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border Background="{TemplateBinding Background}" 
                                                                CornerRadius="12"
                                                                Padding="{TemplateBinding Padding}">
                                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                        </Border>
                                                        <ControlTemplate.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter Property="Background" Value="#28A745"/>
                                                                <Setter Property="Foreground" Value="White"/>
                                                            </Trigger>
                                                        </ControlTemplate.Triggers>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </Button.Style>
                                </Button>
                            </Grid>
                        </Border>

                        <!-- Список автомобилей -->
                        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="25,20">
                            <ItemsControl ItemsSource="{Binding Cars}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <UniformGrid Columns="3" HorizontalAlignment="Center"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Margin="10" 
                                                Padding="0" 
                                                CornerRadius="20" 
                                                Width="300"
                                                Cursor="Hand"
                                                BorderThickness="3"
                                                MouseLeftButtonDown="CarCard_MouseLeftButtonDown">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Background" Value="#FAFAFA"/>
                                                    <Setter Property="BorderBrush" Value="#E8E8E8"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                                            <Setter Property="Background" Value="#FFFDF5"/>
                                                            <Setter Property="BorderBrush" Value="#FFC107"/>
                                                        </DataTrigger>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Background" Value="#F5F5F5"/>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <Border.Effect>
                                                <DropShadowEffect BlurRadius="15" ShadowDepth="3" Opacity="0.15" Color="Black"/>
                                            </Border.Effect>
                                            <Grid>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="150"/>
                                                    <RowDefinition Height="Auto"/>
                                                </Grid.RowDefinitions>

                                                <!-- Фото авто -->
                                                <Border Grid.Row="0" CornerRadius="20,20,0,0" Background="#F0F0F0">
                                                    <Image Source="{Binding PhotoPath, Converter={StaticResource PathToImageConverter}}" 
                                                           Stretch="UniformToFill"
                                                           VerticalAlignment="Center"
                                                           HorizontalAlignment="Center"/>
                                                </Border>

                                                <!-- Галочка выбора -->
                                                <Border Grid.Row="0" 
                                                        Width="35" 
                                                        Height="35" 
                                                        CornerRadius="17.5" 
                                                        Background="#FFC107" 
                                                        HorizontalAlignment="Right" 
                                                        VerticalAlignment="Top" 
                                                        Margin="0,12,12,0"
                                                        Visibility="{Binding IsSelected, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                    <TextBlock Text="✓" 
                                                               FontSize="18" 
                                                               FontWeight="Bold" 
                                                               Foreground="White" 
                                                               HorizontalAlignment="Center" 
                                                               VerticalAlignment="Center"/>
                                                </Border>

                                                <!-- Информация -->
                                                <StackPanel Grid.Row="1" Margin="20,15,20,20">
                                                    <TextBlock Text="{Binding ModelName}" 
                                                               FontSize="18" 
                                                               FontWeight="Bold" 
                                                               Foreground="#333333"
                                                               TextTrimming="CharacterEllipsis"/>
                                                    
                                                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                                        <Border Background="#F0F0F0" CornerRadius="5" Padding="8,4" Margin="0,0,8,0">
                                                            <TextBlock Text="{Binding LicensePlate}" 
                                                                       FontSize="12" 
                                                                       FontWeight="SemiBold" 
                                                                       Foreground="#666666"/>
                                                        </Border>
                                                        <Border CornerRadius="5" Padding="8,4">
                                                            <Border.Style>
                                                                <Style TargetType="Border">
                                                                    <Setter Property="Background" Value="#E8F5E9"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding Tariff}" Value="Комфорт">
                                                                            <Setter Property="Background" Value="#E3F2FD"/>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Tariff}" Value="Бизнес">
                                                                            <Setter Property="Background" Value="#FFF8E1"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </Border.Style>
                                                            <TextBlock Text="{Binding Tariff}" FontSize="12" FontWeight="SemiBold">
                                                                <TextBlock.Style>
                                                                    <Style TargetType="TextBlock">
                                                                        <Setter Property="Foreground" Value="#28A745"/>
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding Tariff}" Value="Комфорт">
                                                                                <Setter Property="Foreground" Value="#1976D2"/>
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding Tariff}" Value="Бизнес">
                                                                                <Setter Property="Foreground" Value="#F57C00"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </TextBlock.Style>
                                                            </TextBlock>
                                                        </Border>
                                                    </StackPanel>

                                                    <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                                        <TextBlock Text="🎨" FontSize="12" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                                        <TextBlock Text="{Binding Color}" FontSize="13" Foreground="#666666" VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>

                        <!-- Нижняя панель с кнопками -->
                        <Border Grid.Row="2" Background="#F8F8F8" CornerRadius="0,0,25,25" Padding="30,20">
                            <Grid>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                                    <Button Content="📋 Подробнее" 
                                            Command="{Binding ViewDetailsCommand}" 
                                            Padding="20,12"
                                            FontSize="14"
                                            Background="#F0F0F0"
                                            Foreground="#666666"
                                            BorderThickness="0"
                                            Cursor="Hand"
                                            Margin="0,0,10,0">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border Background="{TemplateBinding Background}" 
                                                                    CornerRadius="10"
                                                                    Padding="{TemplateBinding Padding}">
                                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                            </Border>
                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter Property="Background" Value="#E0E0E0"/>
                                                                </Trigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                    <Button Content="ОТМЕНА" 
                                            Command="{Binding CancelCommand}" 
                                            Style="{StaticResource DeclineButton}" 
                                            Padding="30,12"
                                            FontSize="14"
                                            Margin="0,0,15,0"/>
                                    <Button Content="🚗 ВЫБРАТЬ И ВЫЙТИ НА ЛИНИЮ" 
                                            Command="{Binding SelectCarCommand}" 
                                            Style="{StaticResource AcceptButton}" 
                                            Padding="30,12"
                                            FontSize="14"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Grid>
                </Border>
            </Grid>
        </Grid>
    </Border>
</Window>
